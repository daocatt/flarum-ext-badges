(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var r in e)t.o(e,r)&&!t.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:e[r]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a);const e=flarum.core.compat["forum/app"];var r=t.n(e);const s=flarum.core.compat.extend,n=flarum.core.compat.Model;var i=t.n(n);const o=flarum.core.compat["models/User"];var d=t.n(o);const l=flarum.core.compat["components/UserPage"];var u=t.n(l);const c=flarum.core.compat["utils/UserControls"];var g=t.n(c);const p=flarum.core.compat["components/LinkButton"];var b=t.n(p);const f=flarum.core.compat["components/Button"];var h=t.n(f);function y(t,a){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},y(t,a)}function v(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,y(t,a)}const B=flarum.core.compat["utils/mixin"];var N=t.n(B),x=function(t){function a(){return t.apply(this,arguments)||this}return v(a,t),a.prototype.apiEndpoint=function(){return"/badges"+(this.exists?"/"+this.data.id:"")},a}(N()(i(),{name:i().attribute("name"),icon:i().attribute("icon"),order:i().attribute("order"),image:i().attribute("image"),description:i().attribute("description"),isVisible:i().attribute("isVisible"),createdAt:i().attribute("createdAt"),earnedAmount:i().attribute("earnedAmount"),category:i().hasOne("category"),backgroundColor:i().attribute("backgroundColor"),iconColor:i().attribute("iconColor"),labelColor:i().attribute("labelColor")})),C=function(t){function a(){return t.apply(this,arguments)||this}return v(a,t),a.prototype.apiEndpoint=function(){return"/badge-categories"+(this.exists?"/"+this.data.id:"")},a}(N()(i(),{name:i().attribute("name"),order:i().attribute("order"),description:i().attribute("description"),isEnabled:i().attribute("isEnabled"),createdAt:i().attribute("createdAt"),isTable:i().attribute("isTable"),users:i().hasMany("users"),badges:i().hasMany("badges")})),_=function(t){function a(){return t.apply(this,arguments)||this}return v(a,t),a.prototype.apiEndpoint=function(){return"/user-badges"+(this.exists?"/"+this.data.id:"")},a}(N()(i(),{user:i().hasOne("user"),badge:i().hasOne("badge"),description:i().attribute("description"),isPrimary:i().attribute("isPrimary"),assignedAt:i().attribute("assignedAt"),inUserCard:i().attribute("inUserCard")}));const I=flarum.core.compat["components/LoadingIndicator"];var z=t.n(I);const w=flarum.core.compat["common/Component"];var M=t.n(w);const k=flarum.core.compat["common/components/Tooltip"];var U=t.n(k),O=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.tooltip=!1!==this.attrs.tooltip,this.forceVisibility=!0===this.attrs.forceVisibility,this.displayName=!0===this.attrs.displayName},e.view=function(){return this.attrs.badge.isVisible()||this.forceVisibility?!1===this.tooltip?this.badge():m(U(),{text:""+(this.attrs.badge.description()?this.attrs.badge.description():"")},this.badge()):null},e.badge=function(){var t=this,a=!this.attrs.badge.isVisible()&&this.forceVisibility;return this.attrs.badge.image()?m("span",{style:this.displayName?"display:flex;justify-content:flex-start;align-items:center;":"display:inline-block;"},m("img",{src:this.attrs.badge.image(),className:"UserBadgeImage",onclick:function(){t.attrs.onclick&&t.attrs.onclick()},style:{opacity:a?.5:void 0}}),this.displayName&&this.attrs.badge.name()):m("span",{className:"UserBadge UserBadge-"+this.attrs.badge.id(),onclick:function(){t.attrs.onclick&&t.attrs.onclick()},style:{backgroundColor:this.attrs.badge.backgroundColor(),color:this.attrs.badge.labelColor(),borderColor:this.attrs.badge.backgroundColor(),opacity:a?.5:void 0}},m("i",{className:this.attrs.badge.icon(),style:{color:this.attrs.badge.iconColor()}})," ",this.attrs.badge.name())},a}(M());const D=flarum.core.compat["components/Modal"];var P=t.n(D);const L=flarum.core.compat["utils/ItemList"];var S=t.n(L);flarum.core.compat["components/Select"];const A=flarum.core.compat["utils/Stream"];var T=t.n(A),j=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){var e=this;t.prototype.oninit.call(this,a),this.selectedBadge=this.attrs.badge?this.attrs.badge.badge():null,this.user=this.attrs.badge?this.attrs.badge.user():this.attrs.user,this.userHasBadge=!1,this.badge=this.attrs.badge?this.attrs.badge:app.store.createRecord("userBadges"),this.description=T()(this.badge.description()),app.userBadges.load(this.user.attribute("username")),this.categories={},this.uncategorizedBadges=[],this.loading=!1,this.attrs.badge||(this.loading=!0,app.store.find("badges",{include:"category"}).then((function(t){t.forEach((function(t){if(t.category()){var a=t.category();e.categories[a.id()]?e.categories[a.id()].badges.push(t):e.categories[a.id()]={category:a,badges:[t]}}else e.uncategorizedBadges.push(t)})),e.loading=!1,m.redraw()})))},e.className=function(){return"Modal--small BadgeModal"},e.title=function(){return app.translator.trans("gtdxyz-flarum-badges.forum."+(this.badge.exists?"update":"give")+"_badge")},e.content=function(){return m("div",null,m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray())),m("div",{className:"Modal-footer"},m(h(),{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:this.userHasBadge},app.translator.trans("core.forum.composer_edit.submit_button"))))},e.fields=function(){var t=this,a=new(S());return a.add("badge",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("gtdxyz-flarum-badges.forum.badge.badge"))),m("div",{className:"Select"},m("select",{value:this.selectedBadge?this.selectedBadge.id():"empty",disabled:!!this.attrs.badge,onchange:function(a){"empty"!==a.target.value&&(t.selectedBadge=app.store.getById("badges",a.target.value),t.checkUserHasBadge(t.selectedBadge))},className:"Select-input FormControl"},m("option",{value:"empty"},app.translator.trans("gtdxyz-flarum-badges.forum.select_badge")),!this.attrs.badge&&Object.values(this.categories).map((function(t){var a=t.category,e=t.badges;return m("optgroup",{label:a.name()},e.map((function(t){return m("option",{value:t.id()},t.name())})))})),!this.attrs.badge&&this.uncategorizedBadges.length>=1&&m("optgroup",{label:app.translator.trans("gtdxyz-flarum-badges.forum.uncategorized")},this.uncategorizedBadges.map((function(t){return m("option",{value:t.id()},t.name())}))),!!this.attrs.badge&&m("option",{value:this.selectedBadge.id()},this.selectedBadge.name())),m("i",{class:"icon fas fa-caret-down Select-caret"})),this.userHasBadge&&m("p",{className:"UserHasBadge"},app.translator.trans("gtdxyz-flarum-badges.forum.user_has_badge"))),30),a.add("badge_description",m("div",{className:"BadgeModalListItem"},m("p",null,this.selectedBadge?this.selectedBadge.description():app.translator.trans("gtdxyz-flarum-badges.forum.select_badge"))),30),a.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("gtdxyz-flarum-badges.forum.badge.earning_reason"))),m("textarea",{className:"FormControl",placeholder:app.translator.trans("gtdxyz-flarum-badges.forum.badge.earning_reason"),bidi:this.description})),30),a},e.checkUserHasBadge=function(t){var a=!1;(app.userBadges.cache||[]).map((function(e){e.badge()==t&&(a=!0)})),this.userHasBadge=a,m.redraw()},e.onsubmit=function(t){var a=this;t.preventDefault(),this.loading=!0,this.badge.save({description:this.description(),relationships:this.attrs.badge?{}:{badge:this.selectedBadge,user:this.user}}).then((function(){a.attrs.badge?app.modal.show(V,{badge:a.attrs.badge.badge(),userBadgeData:a.attrs.badge}):a.hide(),m.redraw()}),(function(t){a.loading=!1,a.handleErrors(t)}))},a}(P());function E(t,a){if(!t||t.length<4)return"";var e=t.replace("#","");return 3===e.length&&(e+=e),"rgba("+parseInt(e.slice(0,2),16)+","+parseInt(e.slice(2,4),16)+","+parseInt(e.slice(4,6),16)+","+a+")"}var V=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.loading=!1},e.className=function(){return"Modal--small BadgeModal BadgeModal-plain"},e.title=function(){},e.content=function(){var t=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),m("div",{className:"Modal-footer"},m(b(),{href:app.route("badges.detail",{id:this.attrs.badge.id()}),className:"Button",style:{margin:"0 10px"}},app.translator.trans("gtdxyz-flarum-badges.forum.badge.badge_details")),this.attrs.userBadgeData&&app.forum.attribute("canGiveBadge")&&m(h(),{className:"Button Button--primary",onclick:function(){confirm(app.translator.trans("gtdxyz-flarum-badges.forum.moderation.remove_badge_confirm"))&&(t.loading=!0,t.attrs.userBadgeData.delete().then((function(){return t.hide()})))},loading:this.loading},app.translator.trans("gtdxyz-flarum-badges.forum.moderation.remove_badge"))))},e.data=function(){var t=new(S()),a=E(this.attrs.badge.backgroundColor(),.7),e=E(this.attrs.badge.backgroundColor(),1);if(t.add("name",m("div",{className:"BadgeModalListItem name",style:{background:"radial-gradient("+a+","+e+")"}},this.attrs.badge.image()?m("img",{src:this.attrs.badge.image(),className:"icon"}):m("i",{className:this.attrs.badge.icon(),style:"color:"+this.attrs.badge.iconColor()}))),t.add("description",m("div",{className:"BadgeModalListItem description"},m("p",{className:"name"},this.attrs.badge.name()),m("p",null,this.attrs.badge.description()))),this.attrs.userBadgeData&&t.add("category",m("div",{className:"BadgeModalListItem category"},m("p",null,this.attrs.badge.category()&&this.attrs.badge.category().name(),!this.attrs.badge.category()&&app.translator.trans("gtdxyz-flarum-badges.forum.uncategorized")))),this.attrs.userBadgeData){var r=dayjs(this.attrs.userBadgeData.assignedAt()).format("YYYY-MM-DD");t.add("earned_date",m("div",{className:"BadgeModalListItem earned-on"},m("p",null,r)))}return t},a}(P()),Y=function(t){function a(){return t.apply(this,arguments)||this}return v(a,t),a.prototype.view=function(){var t=function(t){var a={},e=[];(t||[]).map((function(t){if(!t)return null;if(t.badge().category()){var r=t.badge().category();a[r.id()]?a[r.id()].badges.push(t):a[r.id()]={name:r.name(),category:r,badges:[t]}}else e.push(t)}));var r=Object.keys(a).sort((function(t,e){return a[t].category.order()-a[e].category.order()})).map((function(t){return a[t]}));return e.length>=1&&r.push({name:app.translator.trans("gtdxyz-flarum-badges.forum.uncategorized"),category:null,badges:e}),r}(app.userBadges.cache||[]);return m("div",{className:"UserBadges"},0===t.length&&m("div",{className:"Placeholder"},m("p",null,app.translator.trans("gtdxyz-flarum-badges.forum.user_no_badges"))),t.length>=1&&t.map((function(t){var a=t.name,e=t.category,r=t.badges;return e&&!e.isEnabled()?null:m("div",{className:"UserBadgesCategory"},m("h3",null,a),e&&e.description()&&m("p",null,e.description()),m("div",{className:"badgeList"},r.sort((function(t,a){return t.badge().order()-a.badge().order()})).map((function(t){return m(O,{badge:t.badge(),onclick:function(){return app.modal.show(V,{badge:t.badge(),userBadgeData:t})}})}))))})))},a}(M()),H=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.user=null,this.loading=!0,this.loadUser(m.route.param("username")),app.userBadges.load(m.route.param("username"))},e.content=function(){return!this.user||this.loading?m(z(),{size:46}):app.session.user?Y.component({user:this.user}):m("div",{className:"Placeholder"},m("p",null,app.translator.trans("gtdxyz-flarum-badges.forum.hidden_badges")))},e.show=function(a){t.prototype.show.call(this,a),this.user=a,this.loading=!1},a}(u());const R=flarum.core.compat["components/Page"];var G=t.n(R);const F=flarum.core.compat["components/IndexPage"];var q=t.n(F);const J=flarum.core.compat["common/helpers/listItems"];var K=t.n(J);const Q=flarum.core.compat["components/Link"];var W=t.n(Q),X=function(t){function a(){return t.apply(this,arguments)||this}return v(a,t),a.prototype.view=function(){if(!this.attrs.badges)return null;var t=this.attrs.badges;return m("table",{width:"100%",className:"BadgeTable"},m("thead",null,m("tr",null,m("th",{scope:"col"},app.translator.trans("gtdxyz-flarum-badges.forum.badge.badges")),m("th",{scope:"col"},app.translator.trans("gtdxyz-flarum-badges.forum.badge.description")))),m("tbody",null,t.map((function(t){return m("tr",null,m("td",null,m(W(),{href:app.route("badges.detail",{id:t.id()})},m(O,{badge:t,tooltip:!1}))),m("td",null,t.description(),m("div",{className:"BadgeTableRewarded"},app.translator.trans("gtdxyz-flarum-badges.forum.badge.earned_count",{count:t.earnedAmount()}))))}))))},a}(M()),Z=function(t){function a(){return t.apply(this,arguments)||this}return v(a,t),a.prototype.view=function(){if(!this.attrs.badges)return null;var t=this.attrs.badges;return m("ul",{className:"BadgeCategoryList"},t.map((function(t){return m("li",null,m(W(),{href:app.route("badges.detail",{id:t.id()}),className:"BadgeContainer"},m("div",{className:"BadgeContainerInfo"},m(O,{badge:t,tooltip:!1}),app.forum.attribute("canViewDetailedBadgeUsers")&&m("p",null,app.translator.trans("gtdxyz-flarum-badges.forum.badge.earned_count",{count:t.earnedAmount()})))))})))},a}(M()),$=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){var e=this;t.prototype.oninit.call(this,a),this.bodyClass="App--index",this.loading=!0,app.history.push("badges"),app.setTitle(app.translator.trans("gtdxyz-flarum-badges.forum.badge.badges")),app.store.find("badge-categories").then((function(){e.loading=!1,m.redraw()}))},e.view=function(){var t=app.store.all("badgeCategories").sort((function(t,a){return t.order()-a.order()}));return m("div",{className:"IndexPage"},m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,K()(q().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("h2",{className:"BadgeOverviewTitle"},app.translator.trans("gtdxyz-flarum-badges.forum.badge.badges")),this.loading&&m(z(),{size:"large"}),!this.loading&&t.map((function(t){var a=t.badges().sort((function(t,a){return t.order()-a.order()}));if(a.length>0)return m("div",{className:"BadgeCategory"},m("h3",null,t.name()),t.description()&&m("p",null,t.description()),t.isTable()&&m(X,{badges:a}),!t.isTable()&&m(Z,{badges:a}))}))))))},a}(G());const tt=flarum.core.compat["helpers/avatar"];var at=t.n(tt);flarum.core.compat["helpers/humanTime"];var et=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.attrs.state.refreshParams({filter:{badge:this.attrs.badgeId},sort:"-assignedAt"})},e.view=function(){var t=this.attrs.state,a=null;return t.isInitialLoading()||t.isLoadingNext()?a=z().component({size:"large"}):t.hasNext()&&(a=h().component({className:"Button",icon:"fas fa-chevron-down",onclick:t.loadNext.bind(t)},app.translator.trans("core.forum.discussion_list.load_more_button"))),t.isInitialLoading()&&t.isEmpty()?m(z(),null):t.isEmpty()?m("div",{className:"BadgeDetailContent-empty"},app.translator.trans("gtdxyz-flarum-badges.forum.no_received")):m("div",null,m("ul",{className:"BadgeDetailContent"},t.getPages().map((function(t){return t.items.map((function(t){return m("li",null,m(W(),{href:app.route("user",{username:t.user().username()}),className:"BadgeDetailContent-user"},at()(t.user()),m("div",{className:"BadgeDetailContentuserinfo"},m("h4",null,t.user().displayName()))))}))}))),a&&m("div",{className:"SupportSearchList-loadMore"},a))},a}(M()),rt=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){var e=this;t.prototype.oninit.call(this,a),this.bodyClass="App--index";var r=app.store.getById("badges",m.route.param("id"));this.loading=!r,r?(app.history.push("badgeDetailPage",r.name()),this.setTitle(r)):app.store.find("badges/"+m.route.param("id")).then((function(t){e.loading=!1,app.history.push("badgeDetailPage",t.name()),e.setTitle(t),m.redraw()}))},e.setTitle=function(t){app.setTitle(t.name()+" - "+app.translator.trans("gtdxyz-flarum-badges.forum.badge.badges"))},e.view=function(){var t=app.store.getById("badges",m.route.param("id"));return m("div",{className:"IndexPage"},m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,K()(q().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m(b(),{href:app.route("badges"),icon:"fas fa-chevron-left",className:"Button BadgesOverviewButton"},app.translator.trans("gtdxyz-flarum-badges.forum.badge.badges")),this.loading&&m(z(),{size:"large"}),!this.loading&&m("div",{className:"BadgeDetailContent-Info"},m(O,{badge:t,tooltip:!1}),m("div",{className:"BadgeDetailContent-Info-meta"},m("h3",null,t.name()),m("p",null,t.description()))),t&&app.forum.attribute("canViewDetailedBadgeUsers")&&m("h3",null,app.translator.trans("gtdxyz-flarum-badges.forum.badge.earned_by_count",{count:t.earnedAmount()})),!this.loading&&app.forum.attribute("canViewDetailedBadgeUsers")&&m(et,{state:app.badgeUserListState,badgeId:t.id()})))))},a}(G());function st(t){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}function nt(t){var a=function(t,a){if("object"!=st(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=st(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==st(a)?a:a+""}function it(t,a){for(var e=0;e<a.length;e++){var r=a[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nt(r.key),r)}}const ot=flarum.core.compat["common/states/PaginatedListState"];var dt=function(t){function a(a,e){return void 0===e&&(e=1),t.call(this,a,e,18)||this}return v(a,t),e=a,(r=[{key:"type",get:function(){return"user-badges"}}])&&it(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r}(t.n(ot)());const lt=flarum.core.compat["forum/components/Notification"];var ut=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.icon=function(){return""},e.href=function(){return app.route("user.badges",{username:app.session.user.username()})},e.content=function(){return app.translator.trans("gtdxyz-flarum-badges.forum.notification.title")},e.excerpt=function(){var t=this.attrs.notification.subject();return m("div",null,m("i",{className:"icon "+t.attribute("icon")}),t.attribute("name"))},a}(t.n(lt)());const ct=flarum.core.compat["forum/components/NotificationGrid"];var mt=t.n(ct);const gt=flarum.core.compat["common/extend"],pt=flarum.core.compat["forum/components/UserCard"];var bt=t.n(pt),ft=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.view=function(){var t=this.attrs.badge,a=!1!==this.attrs.tooltip,e=!0===this.attrs.forceVisibility;return t.isVisible||e?!1===a?this.badge():m(U(),{text:""+(t.description?t.description:"")},this.badge(t,e)):null},e.badge=function(t,a){var e=this,r=!t.isVisible&&a;return t.image?m("img",{src:t.image,className:"UserBadgeImage",onclick:function(){e.attrs.onclick&&e.attrs.onclick()},style:{opacity:r?.5:void 0}}):m("span",{className:"UserBadge UserBadge-"+t.id,onclick:function(){e.attrs.onclick&&e.attrs.onclick()},style:{backgroundColor:t.backgroundColor,color:t.labelColor,borderColor:t.backgroundColor,opacity:r?.5:void 0}},m("i",{className:t.icon,style:{color:t.iconColor}})," ",t.name)},a}(M()),ht=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.loading=!1,this.badgeItem=this.attrs.badge,this.badgeData=this.attrs.badgeData},e.className=function(){return"Modal--small BadgeModal BadgeModal-plain"},e.title=function(){},e.content=function(){var t=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),m("div",{className:"Modal-footer"},m(b(),{href:app.route("badges.detail",{id:this.badgeItem.id}),className:"Button",style:{margin:"0 10px"}},app.translator.trans("gtdxyz-flarum-badges.forum.badge.badge_details")),this.badgeData&&app.forum.attribute("canGiveBadge")&&m(h(),{className:"Button Button--primary",onclick:function(){if(confirm(app.translator.trans("gtdxyz-flarum-badges.forum.moderation.remove_badge_confirm"))){t.loading=!0;var a=t;app.request({method:"DELETE",url:app.forum.attribute("apiUrl")+"/user-badges/"+t.badgeData.id,body:{}}).then((function(){a.hide()}))}},loading:this.loading},app.translator.trans("gtdxyz-flarum-badges.forum.moderation.remove_badge"))))},e.data=function(){var t=new(S()),a=E(this.badgeItem.background_color,.7),e=E(this.badgeItem.background_color,1);if(t.add("name",m("div",{className:"BadgeModalListItem name",style:{background:"radial-gradient("+a+","+e+")"}},this.badgeItem.image?m("img",{src:this.badgeItem.image,className:"icon"}):m("i",{className:this.badgeItem.icon,style:"color:"+this.badgeItem.icon_color}))),t.add("description",m("div",{className:"BadgeModalListItem description"},m("p",{className:"name"},this.badgeItem.name),m("p",null,this.badgeItem.description))),this.badgeData){var r=dayjs(this.badgeData.assigned_at).format("YYYY-MM-DD");t.add("earned_date",m("div",{className:"BadgeModalListItem earned-on"},m("p",null,r)))}return t},a}(P());const yt=flarum.core.compat["components/Switch"];var vt=t.n(yt),Bt=function(t){function a(){return t.apply(this,arguments)||this}v(a,t);var e=a.prototype;return e.oninit=function(a){t.prototype.oninit.call(this,a),this.loading=!1,this.limit=app.forum.attribute("numberOfBadgesOnUserCard"),this.selectedBadges=this.attrs.user.attribute("badges").filter((function(t){return 0!=t.in_uer_card})).map((function(t){return t.id})),app.userBadges.load(this.attrs.user.attribute("username"))},e.className=function(){return"Modal--big UserCardBadgesModal"},e.title=function(){return app.translator.trans("gtdxyz-flarum-badges.forum.badges_in_card.title")},e.content=function(){var t=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),m("div",{className:"Modal-footer"},m(h(),{className:"Button Button--primary",onclick:function(){return t.save()},loading:this.loading},app.translator.trans("gtdxyz-flarum-badges.forum.save_changes"))))},e.data=function(){var t=this,a=new(S()),e=app.userBadges.cache||[];return a.add("info",m("div",{className:"BadgeModalListItem"},m("p",null,app.translator.trans("gtdxyz-flarum-badges.forum.badges_in_card.description")),m("p",null,app.translator.trans("gtdxyz-flarum-badges.forum.badges_in_card.select_limit",{limit:app.forum.attribute("numberOfBadgesOnUserCard")})))),a.add("badge-list",m("div",{className:"UserCardBadgesModalCategory"},e.map((function(a){var e=parseInt(a.id()),r=t.selectedBadges.length>=t.limit&&-1===t.selectedBadges.indexOf(e);return m(U(),{text:r?app.translator.trans("gtdxyz-flarum-badges.forum.badges_in_card.hit_limit",{limit:app.forum.attribute("numberOfBadgesOnUserCard")}):"",position:"bottom"},m("div",{className:"UserCardBadgesModalCategory-badge",onclick:function(){if(!r){var a=t.selectedBadges.indexOf(e);a>=0?t.selectedBadges.splice(a,1):t.selectedBadges.push(e)}}},m("div",{className:"UserCardBadgesModalCategory-badge-preview"},m(O,{badge:a.badge(),onclick:function(){}}),a.badge().image()&&m("div",{className:"preview-name"},a.badge().name())),m("div",{className:"UserCardBadgesModalCategory-badge-switch"},vt().component({state:t.selectedBadges.indexOf(e)>=0,disabled:r}))))})))),a},e.save=function(){var t=this;this.loading=!0,this.attrs.user.save({userCardBadges:this.selectedBadges}).then((function(){t.hide()})).catch((function(){})).then((function(){t.loading=!1,m.redraw()}))},a}(P()),Nt=function(){function t(t){this.app=t,this.loading=!1}return t.prototype.load=function(t){var a=this;this.cache||(this.loading=!0,m.redraw(),this.app.store.find("user-badges",{filter:{user:t}}).then((function(t){a.cache=t})).catch((function(){})).then((function(){a.loading=!1,m.redraw()})))},t}();r().initializers.add("gtdxyz-flarum-badges",(function(){r().store.models.badges=x,r().store.models.badgeCategories=C,_.prototype.badge=i().hasOne("badge"),r().store.models.userBadges=_,d().prototype.userBadges=i().hasMany("userBadges"),r().userBadges=new Nt(r()),r().routes["user.badges"]={path:"/u/:username/badges",component:H},r().routes.badges={path:"/badges",component:$},r().routes["badges.detail"]={path:"/badges/:id",component:rt},(0,s.extend)(q().prototype,"navItems",(function(t){return t.add("badges",m(b(),{icon:"fas fa-id-badge",href:app.route("badges")},app.translator.trans("gtdxyz-flarum-badges.forum.badge.badges")),15),t})),r().badgeUserListState=new dt({}),r().notificationComponents.badgeReceived=ut,(0,s.extend)(mt().prototype,"notificationTypes",(function(t){t.add("badgeReceived",{name:"badgeReceived",icon:"fas fa-user-tag",label:r().translator.trans("gtdxyz-flarum-badges.forum.notification.settings")})})),(0,s.extend)(u().prototype,"navItems",(function(t){r().session.user&&t.add("badges",b().component({href:r().route("user.badges",{username:this.user.username()}),name:"badges",icon:"fas fa-user-tag"},[r().translator.trans("gtdxyz-flarum-badges.forum.badge.badges")]),15)})),(0,s.extend)(g(),"moderationControls",(function(t,a){r().forum.attribute("canGiveBadge")&&t.add("test",m(h(),{icon:"fas fa-user-tag",onclick:function(){return r().modal.show(j,{user:a})}},r().translator.trans("gtdxyz-flarum-badges.forum.give_badge")))})),(0,gt.extend)(bt().prototype,"infoItems",(function(t){var a,e=this.attrs.user;if(r().forum.attribute("showBadgesOnUserCard")&&e.attribute("badges")){var s=null!=(a=e.attribute("badges"))?a:[];if(!(e.attribute("badges_count")<=0)){r().forum.attribute("numberOfBadgesOnUserCard");var n=[];s.forEach((function(t,a){n.push(m(ft,{badge:t.badge,onclick:function(){return r().modal.show(ht,{badge:t.badge,badgeData:t})}}))})),(r().session.user&&e.id()===r().session.user.id()&&r().forum.attribute("editOwnUserCardBadges")||r().forum.attribute("editUserCardBadges"))&&n.push(m(U(),{text:r().translator.trans("gtdxyz-flarum-badges.forum.badges_in_card.manage_badges")},m("a",{href:"#",className:"UserBadge more-badges",onclick:function(t){t.preventDefault(),r().modal.show(Bt,{user:e})}},m("i",{className:"fas fa-pencil-alt BadgeIconOnly"})))),t.add("badges",n)}}}))}))})(),module.exports=a})();
//# sourceMappingURL=forum.js.map